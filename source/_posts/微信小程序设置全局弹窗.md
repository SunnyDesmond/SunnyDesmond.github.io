---
title: 微信小程序设置全局弹窗
date: 2019-04-18 10:00:43
description: 微信小程序
tags: [微信小程序]
categories: "微信小程序"
---
## 废话
前段时间太忙了，然后又太懒，导致好久没有更新，实在是惭愧啊。。。

## 需求
最近做了一个小程序中的一个需求。大概是这样的：需要做一个全局弹窗。然后在小程序运行期间只打开一次，只有关闭微信的时候再打开小程序才弹出来这个弹窗，否则都只展示一次，哪怕是点小程序右上角将小程序隐藏进后台，也展示一次。
本来把这个需求想的有些麻烦，一开始想给这个全局弹窗弄个变量，存到`localStorge`里面，然后每次打开app的时候，读取这个变量。卸载app后清除这个变量。但是后来发现，小程序的`onUnload`和`onHide`都不能监听到app的卸载。
最后在小伙伴的提示下，发现只要给这个变量赋值到`aap.js`中就行了，然后运行完这个弹窗就将这个全局变量置为`false`即可。。。

## 代码

```
app.js
·········
onLaunch: function (options) {
    this.globalData.needShowLaunchAd = true;
  },
·······
```

```
const App = getApp();
········
 if (App.globalData.needShowLaunchAd){
      App.globalData.needShowLaunchAd=false;
    }
·······
```

## 官方概念
>>> ###小程序启动
>>> 小程序启动会有两种情况，一种是「冷启动」，一种是「热启动」。
>>> 热启动：假如用户已经打开过某小程序，然后在一定时间内再次打开该小程序，此时无需重新启动，只需将后台态的小程序切换到前台，这个过程就是热启动；
>>> 冷启动：用户首次打开或小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动，即冷启动。
>>> 小程序没有重启的概念。

>>> ##小程序销毁
>>> 需要注意的是：只有当小程序进入后台一定时间，或者系统资源占用过高，才会被真正的销毁。
>>> 当小程序进入后台，客户端会维持一段时间的运行状态，超过一定时间后（目前是5分钟）小程序会被微信主动销毁。
>>> 当小程序占用系统资源过高，可能会被系统销毁或被微信客户端主动回收。
>>> 在 iOS 上，当微信客户端在一定时间间隔内（目前是 5 秒）连续收到两次及以上系统内存告警时，会主动进行小程序的销毁，并提示用户 「该小程序可能导致微信响应变慢被终止」。
>>> 建议小程序在必要时使用 wx.onMemoryWarning 监听内存告警事件，进行必要的内存清理。

即，只有在冷启动的时候，`app.js`中的变量才会开始初始赋值，否者会一直存在，通过此特性，我们就可以轻松做到一开始提到的需求啦。
